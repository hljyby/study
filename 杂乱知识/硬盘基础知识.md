# [硬盘基本知识（磁头、磁道、扇区、柱面）](https://www.cnblogs.com/jswang/p/9071847.html)

## 概述

1. 盘片（platter）
2. 磁头（head）
3. 磁道（track）
4. 扇区（sector）
5. 柱面（cylinder）

#### 盘片 片面 和 磁头

硬盘中一般会有多个盘片组成，每个盘片包含两个面，每个盘面都对应地有一个读/写磁头。受到硬盘整体体积和生产成本的限制，盘片数量都受到限制，一般都在5片以内。盘片的编号自下向上从0开始，如最下边的盘片有0面和1面，再上一个盘片就编号为2面和3面。
如下图：



 

![img](https://upload-images.jianshu.io/upload_images/2843224-46fb935cd31addbd.png)

图1

#### 扇区 和 磁道

下图显示的是一个盘面，盘面中一圈圈灰色同心圆为一条条磁道，从圆心向外画直线，可以将磁道划分为若干个弧段，每个磁道上一个弧段被称之为一个扇区（图践绿色部分）。扇区是磁盘的最小组成单元，通常是512字节。（由于不断提高磁盘的大小，部分厂商设定每个扇区的大小是4096字节）

 

![img](https://upload-images.jianshu.io/upload_images/2843224-56f2056f0b36009f.png)

图2

#### 磁头 和 柱面

硬盘通常由重叠的一组盘片构成，每个盘面都被划分为数目相等的磁道，并从外缘的“0”开始编号，具有相同编号的磁道形成一个圆柱，称之为磁盘的柱面。磁盘的柱面数与一个盘面上的磁道数是相等的。由于每个盘面都有自己的磁头，因此，盘面数等于总的磁头数。 如下图



 

![img](https://upload-images.jianshu.io/upload_images/2843224-e0854f19c817c83c.png)

图3

## 磁盘容量计算

存储容量 ＝ 磁头数 × 磁道(柱面)数 × 每道扇区数 × 每扇区字节数

图3中磁盘是一个 3个圆盘6个磁头，7个柱面（每个盘片7个磁道） 的磁盘，图3中每条磁道有12个扇区，所以此磁盘的容量为：

存储容量 6 * 7 * 12 * 512 = 258048

> 每个磁道的扇区数一样是说的老的硬盘，外圈的密度小，内圈的密度大，每圈可存储的数据量是一样的。新的硬盘数据的密度都一致，这样磁道的周长越长，扇区就越多，存储的数据量就越大。

## 磁盘读取响应时间

1. 寻道时间：磁头从开始移动到数据所在磁道所需要的时间，寻道时间越短，I/O操作越快，目前磁盘的平均寻道时间一般在3－15ms，一般都在10ms左右。
2. 旋转延迟：盘片旋转将请求数据所在扇区移至读写磁头下方所需要的时间，旋转延迟取决于磁盘转速。普通硬盘一般都是7200rpm，慢的5400rpm。
3. 数据传输时间：完成传输所请求的数据所需要的时间。
   小结一下：从上面的指标来看、其实最重要的、或者说、我们最关心的应该只有两个：寻道时间；旋转延迟。

> 读写一次磁盘信息所需的时间可分解为：寻道时间、延迟时间、传输时间。为提高磁盘传输效率，软件应着重考虑减少寻道时间和延迟时间。

## 块/簇

#### 概述

磁盘块/簇（虚拟出来的）。 块是操作系统中最小的逻辑存储单位。操作系统与磁盘打交道的最小单位是磁盘块。
通俗的来讲，在Windows下如NTFS等文件系统中叫做簇；在Linux下如Ext4等文件系统中叫做块（block）。每个簇或者块可以包括2、4、8、16、32、64…2的n次方个扇区。

#### 为什么存在磁盘块？

读取方便：由于扇区的数量比较小，数目众多在寻址时比较困难，所以操作系统就将相邻的扇区组合在一起，形成一个块，再对块进行整体的操作。

分离对底层的依赖：操作系统忽略对底层物理存储结构的设计。通过虚拟出来磁盘块的概念，在系统中认为块是最小的单位。

## page

操作系统经常与内存和硬盘这两种存储设备进行通信，类似于“块”的概念，都需要一种虚拟的基本单位。所以，与内存操作，是虚拟一个页的概念来作为最小单位。与硬盘打交道，就是以块为最小单位。

## 扇区、块/簇、page的关系

1. 扇区： 硬盘的最小读写单元
2. 块/簇： 是操作系统针对硬盘读写的最小单元
3. page： 是内存与操作系统之间操作的最小单元。

扇区 <= 块/簇 <= page

## **磁盘的分区**

装过系统的人都知道必须要分区后才能安装系统，形象点的说比如windows里C:、D:之类的东西；如果你要问硬盘为什么要分区，我也说不上来很严格的原因，**首先从使用习惯上来讲，我们不希望数据杂乱无章堆积在一起，其次，如果不分区，如何才能在一块硬盘上使用不同的文件系统(下面讲到)呢，学院派的说法是：数据安全和性能考虑。**

### **先要说硬盘中最最重要的第一扇区，因为整块硬盘的重要信息都在这里：**

MBR(Master Boot Record 主启动记录)：开机引导程序就在安装在此，占用446byte

DPT(Disk Partition table 硬盘分区表)：记录硬盘上的分区元信息，占用64byte

MBR是如何工作的呢，不用深究，反正就是系统开始时会主动读取数据的地方，这样才能引导进行操作系统的启动；DPT要仔细的讲讲，分区的大致意思就如同抢地盘，不过人家比较规矩，按照柱面(最小的分区单位)分配，比如第一个分区从柱面1-200，第二个分区201-500，但三个分区501-1000...(省略并非可以无限分配下去哦)

![img](http://5b0988e595225.cdn.sohucs.com/images/20180102/da62dc65de8a45e4b00e55613e06a590.jpeg)

![img](http://5b0988e595225.cdn.sohucs.com/images/20180102/8f001751a3b6432dab6f26c09d1ab74d.jpeg)

为啥说不能一直分配下去呢，技术柱面数量足够，因为上面说到硬盘分区表只有64个字节，每条分区记录需要占用16字节，最多只能分4个。疑问在此：我的电脑怎么分了5个(cdefg)？

其实我说的4个分区是所谓的主分区，为了能支持很多分区引入了扩展分区的概念， 也就是说，可以使用DPT中一条记录来记录扩展分区的信息，然后在扩展分区中再继续划分逻辑分区，而逻辑分区的分区信息则记录在扩展分区的第一个扇区中，如此则可以像链表一样划分出很多分区来。但注意，一个分区表中可以有1~4条主分区，但是最多只能有1个扩展分区。

![img](http://5b0988e595225.cdn.sohucs.com/images/20180102/408a8f4dc7f4453790e1547bca85700e.jpeg)

![img](http://5b0988e595225.cdn.sohucs.com/images/20180102/8b3530cf07294be5955047a6cc4e62bc.jpeg)

分区表之间是如何关联的，详细讲一下，分区表是一个单向链表，第一个分区表，也就是位于硬盘第一个扇区中的DPT，可以有一项记录扩展分区的起始位置柱面，类似于指针的概念，指向扩展分区(图3)，根据这项记录我们可以找到扩展分区的某柱面0磁头1扇区(CHS)，而这个扇区中又存放了第二个分区表，第二个分区表第一项记录一般表述了当前所在的逻辑分区的起始/终止柱面，第二项记录表述了下一个逻辑分区所在的0磁头1扇区(CHS)，第三、第四项记录不存任何信息(图4)。

请看下图，主引导记录/分区表所在的是硬盘第一个分区，基本分区1、基本分2、基本分区3都是主分区、扩展分区内有2个逻辑分区，每个逻辑分区的第一个扇区都是分区表。

![img](http://5b0988e595225.cdn.sohucs.com/images/20180102/453924a59ffb48e69e9a2cf9cc56cd32.jpeg)

### **分区后的系统启动**

**之前提到MBR中安装的引导加载程序，他的作用是什么?**

① 提供开机菜单选项：可以供用户选择启动哪个操作系统，这是多重引导功能。

② 加载操作系统内核：每个操作系统都有自己的内核，需要引导程序来加载

③ 转交给其他引导程序：可以将工作移交给其他引导程序来进行上述操作。

其实引导加载程序除了可以安装在MBR中，还可以直接安装在每个分区的引导扇区(DBR)中，注意下，每个分区(主分区、逻辑分区)都有一个自己的启动扇区，专门用来安装引导加载程序，如上图表3。

### **系统启动过程**

① 首先,BIOS启动后，读取硬盘第一个扇区MBR中的引导加载程序(可能是windows或者linux的grub)

② MBR中的引导程序提供开机菜单，你可以选择1)直接加载windows 内核 2)将工作转交给windows 分区内的引导扇区中的加载程序，让他自己去加载内核 3)转交给linux分区内引导扇区，让他去加载linux.

③ 根据用户选择的选项和引导加载程序中记录的分区，到分区表找对应的分区柱面号等分区信息，启动内核或者分区加载程序。

Window安装时默认会自动将MBR和windows所在分区的引导扇区都装上引导程序，而不会提供任何选项给用户选择，因此如果之前装过其他操作系统，然后再另外装一个windows时，会把公用的MBR覆盖掉，如此，原来的操作系统就无法启动了。

如果先装windows，然后装linux，linux 会覆盖MBR，然后让用户选择是否将windows等其他操作系统的启动项添加进来，如果你选择了添加进来，那么你在开机时就会有两个选项让用户进行选择了。

### **文件系统**

文件系统也是很大很复杂的话题，我们仍然以比较通俗、粗颗粒度来讲解，试想一下，我们的文件如何对应到磁盘的扇区上呢，所以光有底层的概念 磁道 扇区是没有用的，需要更加抽象的数据类型或结构来抽象底层的细节。

**文件系统是一套实现了数据的存储、分级组织、访问和获取等操作的抽象数据类型(Abstract data type)。****文件系统是一种用于向用户提供底层数据访问的机制。它将设备中的空间划分为特定大小的块(扇区)，一般每块512字节。**

数据存储在这些块中，大小被修正为占用整数个块。由文件系统软件来负责将这些块组织为文件和目录，并记录哪些块被分配给了哪个文件，以及哪些块没有被使用。

不过，文件系统并不一定只在特定存储设备上出现。它是数据的组织者和提供者，至于它的底层，可以是磁盘，也可以是其它动态生成数据的设备(比如网络设备)。

## 1. 基础知识

disk #磁盘
head #磁头
sector #扇区
track #磁道
cylinder #柱面
units #单元快
block #数据块
iNode #索引节点

## 2. 磁盘内部的相关知识

磁盘的组成主要由盘片，机械手臂，磁头与主轴马达所组成，而数据的写入其实是在盘片上面，盘片上面又可细分出扇区与柱面两种单位。一般来说，一块磁盘有1个到数个盘片不等，其中每个盘片的有效盘面对应一个读写磁头，从上到下从0开始依次编号，不同的磁盘面上在逻辑上被化分为track、cylinder、sector。磁盘的一个盘面一般有有300-1024磁道(看不到)，新式大容量的磁盘可能有更多，信息以脉冲串的形式记录在这些轨迹中，这些同心圆不是连续记录数据；扇区是从1开始计数，所有的盘面上同一个磁道的原型轨迹从上向下依次形成一个圆柱体，就称作柱面，从上到下，从0开始。

1. 磁盘的扇区
   操作系统是以扇区为单位将信息存储在磁盘上，一般情况下，每个扇区的大小是512字节，磁盘的第一个扇区很重要，因为第一个扇区记录了两个重要的信息。分别是
   主引导分区：可以安装引导加载程序的地方，由446bytes
   分区表：记录整块硬盘分区的状态，有64bytes
2. 磁盘容量的计算方法
   （1）存储容量=磁头数x磁道数(或柱面数)*每磁道的扇区数*每扇区的字节数
   （2）存储容量=柱面大小(每磁道的扇区数*每扇区的字节数*磁头数)x柱面数(磁道数)
   注意：一块磁盘的磁道数和柱面数的数量是永远相等的；每个扇区的大小一样的大小
3. 磁盘的数据读写流程
   磁盘的读写一般是按柱面进行的，及磁头读写数据是首先在同一柱面内从“0”磁头开始进行操作，依次向下在同一个柱面的不同的不同磁头上进行操作，只在同一个柱面所有的磁头全部读写完毕后，磁头才转移到下一柱面。磁头是电子切换，磁道是步进电机切换。

## 3. 磁盘分区的理论知识

（1）磁盘分区的是指就是针对上述0磁道0扇区64bytes的分区表进行分区。
（2）一块硬盘的分区表仅有64bytes，仅支持4个分区表的信息(主分区+扩展分区)。
（3）磁盘分区的最小单位为柱面(cylinder)。
（4）扩展分区不能直接使用，还需要在扩展分区的基础上创建逻辑分区才行。
（5）扩展分区有自己的分区表，因此扩展分区下面的逻辑分区可以有多个。一块硬盘只能有一块扩展分区，这个扩展分区可以划分为多个逻辑分区，IDE硬盘支持的逻辑分区最大编号63（编号为5-63），而SATA硬盘最大编号为15（5-15）。

1. 主分区Primary
   磁盘上必须存在的分区，一般为第一个分区，我们可以在这个主分区上安装操作系统，一个磁盘最多只能有四个主分区。主分区会在主引导扇区中生成DPT，每个分区表需要占用16bytes，硬盘在设计时只给分区表留下64bytes的存储空间
2. 扩展分区Extended
   严格来说，扩展分区不能算一个正常的分区，而是一个连接，起到一个指向的作用。我们可以在扩展分区内建立逻辑分区(logocal)，一块硬盘只能有一块扩展分区。
3. 逻辑分区logical
   不能在硬盘中单独直接划分逻辑分区，逻辑分区必须存在于扩展分区内，在扩展分区内可以划分多个逻辑分区，逻辑分区的编号从5开始。
4. 磁盘分区的注意事项
   （1）任意多个主分区，但要求是（1-4）
   （2）扩展分区和主分区组合。但要求（主分区和扩展分区之和为2-4）
   （3）如果要分成4个磁盘分区的话PPPP或P(primart)PPPE(extended)
   （4）通过fdisk分区就是再改16字节的分区表，与分区上的数据没有关系，调整分区大小，不会删除分区内的数据
5. 硬盘分区的设备名
   在Linux，是通过设备名来访问设备的，设备名存放在/dev目录中，设备明的定义规则如下：
   系统的第一块IDE接口的硬盘名称为/dev/hda
   系统的第二块IDE接口的硬盘名称为/dev/hdb
   系统的第一块SCSI接口的硬盘名称为/dev/sda
   系统的第一块SCSI接口的硬盘名称为/dev/sdb
6. 磁盘分区应当注意的
   （1）linux环境下没有盘符的概念，需要对磁盘设备进行操作，需要使用磁盘的设备名；读取磁盘的内容需要把创建在分区或逻辑卷上的文件系统挂载在指定目录上
   （2）在Linux系统划分了分区之后还要在分区上建立文件系统
   （3）最少有swap及/两个分区
   （4）swap(交换分区)的作用：虚拟内存，swap分区的大小=1.5*物理内存。如果内打于8-16G。则就用8-16G。
   （5）建议设置独立的/boot分区，Linux引导分区，存放系统引导文件，如Linux内核等，所有文件的大小一般只有几十m，因此该分区设置为100-200m，常见的生产线上一般服务器分区方式/boot,swap,/三个分区。